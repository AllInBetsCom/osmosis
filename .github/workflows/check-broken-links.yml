# Check Broken Links Workflow
#
# This workflow runs on a schedule, specifically on the 1st and 15th days of every month at 10:00 UTC.
# It can also be manually triggered using the workflow_dispatch event.
# The purpose of this workflow is to check for broken links in Markdown and HTML files within the repository.
# If broken links are detected, it creates an issue with the details of the broken links.
#
# Triggers:
# - Schedule (1st and 15th days of every month at 10:00 UTC)
# - workflow_dispatch (manual triggering).
#
# Required Secrets:
# - GITHUB_TOKEN: A token with repository access to perform issue creation.

name: Check Broken Links

on:
  schedule:
    - cron: '0 10 1,15 * *' 
  workflow_dispatch:

jobs:
  check-broken-links:
    name: check-broken-links
    runs-on: ubuntu-latest
    steps:
      -
        name: Check out repository
        uses: actions/checkout@v3
      - 
        name: Link Checker
        id: lychee
        uses: lycheeverse/lychee-action@v1.8.0
        with:
          args: --exclude-loopback --verbose --no-progress './**/*.md' './**/*.html'
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
      - 
        name: Create Issue From File
        if: env.lychee_exit_code != 0
        uses: peter-evans/create-issue-from-file@v4
        with:
          title: Broken Links Detected
          content-filepath: ./lychee/out.md
          labels: report, automated issue, Good first issue, Help wanted
